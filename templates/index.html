<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>To-Do List by Charan</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/styles.css') }}" rel="stylesheet">
    <style>
        .fade-in { animation: fadeIn 0.5s ease-in; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .task-hover:hover { transform: translateY(-2px); transition: transform 0.2s; }
        .overdue { border-left: 4px solid #ef4444; }
    </style>
</head>
<body class="bg-gray-100 font-inter">
    <div class="flex h-screen">
        <!-- Sidebar -->
        <div class="w-64 bg-indigo-200 shadow-lg p-6">
            <h2 class="text-2xl font-bold text-gray-800 mb-6">To-Do App By Charan</h2>
            <form action="{{ url_for('index') }}" method="GET" class="mb-4">
                <label for="date-filter" class="block text-sm font-medium text-gray-700">Filter by Date</label>
                <input
                    type="date"
                    id="date-filter"
                    name="date"
                    value="{{ selected_date or '' }}"
                    onchange="this.form.submit()"
                    class="mt-1 p-2 w-full border rounded-md focus:ring-2 focus:ring-indigo-500"
                />
            </form>
            <a
                href="{{ url_for('index') }}"
                class="block w-full bg-indigo-600 text-white text-center py-2 rounded-md hover:bg-indigo-700 mb-4"
            >
                Show All Tasks
            </a>
            <form action="{{ url_for('index') }}" method="GET">
                <input
                    type="text"
                    name="search"
                    placeholder="Search tasks..."
                    value="{{ search_query or '' }}"
                    class="w-full p-2 border rounded-md focus:ring-2 focus:ring-indigo-500"
                />
                
            </form>
            <div class="mt-4">
                <label for="sort-by" class="block text-sm font-medium text-gray-700">Sort By</label>
                <select
                    id="sort-by"
                    onchange="window.location.href='{{ url_for('index', date=selected_date, search=search_query) }}&sort=' + this.value"
                    class="w-full p-2 border rounded-md"
                >
                    <option value="created_date" {{ 'selected' if sort_by == 'created_date' }}>Created Date</option>
                    <option value="due_date" {{ 'selected' if sort_by == 'due_date' }}>Due Date</option>
                    <option value="category" {{ 'selected' if sort_by == 'category' }}>Category</option>
                </select>
            </div>
        </div>

        <!-- Main Content -->
        <div class="bg-gray-700 flex-1 p-8 overflow-auto">
            <div class="max-w-3xl mx-auto">
                <h1 class="text-3xl font-bold text-white mb-6">Your Tasks</h1>
                {% if selected_date %}
                    <p class="text-white mb-4">Showing tasks for {{ selected_date }}</p>
                {% endif %}

                <!-- Task List -->
                <div class="bg-gray-700  space-y-4" >
                    {% if tasks %}
                        {% for task in tasks %}
                        <div class="bg-gray-300 p-4 rounded-lg shadow-md task-hover fade-in {{ 'overdue' if task.due_date and task.due_date < now.strftime('%Y-%m-%d') and not task.completed }}">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center space-x-4">
                                    <input
                                        id="task-checkbox-{{ task.id }}"
                                        type="checkbox"
                                        {{ 'checked' if task.completed }}
                                        {% if task.id %}
                                            onclick="window.location.href='{{ url_for('toggle_task', task_id=task.id, date=selected_date) }}'"
                                        {% endif %}
                                        class="h-5 w-5 text-indigo-600 rounded focus:ring-indigo-500"
                                    />
                                    <div>
                                        <span class="{{ 'line-through text-gray-500' if task.completed else 'text-gray-800' }} font-medium">
                                            {{ task.title }}
                                        </span>
                                        <p class="text-sm text-gray-500">
                                            Created: {{ task.created_date }} |
                                            {% if task.due_date %}
                                                Due: {{ task.due_date }}
                                                {% if task.due_date < now.strftime('%Y-%m-%d') and not task.completed %}
                                                    <span class="text-red-500 font-medium">(Overdue)</span>
                                                {% endif %}
                                            {% endif %}
                                            | Category: {{ task.category }}
                                        </p>
                                    </div>
                                </div>
                                <div class="flex space-x-2">
                                    <a href="{{ url_for('edit_task', task_id=task.id) }}" class="text-indigo-600 hover:text-indigo-800">Edit</a>
                                    <a href="{{ url_for('delete_task_ui', task_id=task.id, date=selected_date) }}" class="text-red-500 hover:text-red-700">Delete</a>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    {% else %}
                        <p class="text-gray-500 text-center">
                            {% if selected_date %}
                                No tasks for {{ selected_date }}. Add one below!
                            {% else %}
                                No tasks yet. Add one below!
                            {% endif %}
                        </p>
                    {% endif %}
                </div>

                <!-- Add Task Form -->
                <form action="{{ url_for('add_task') }}" method="POST" class="mt-8 bg-white p-6 rounded-lg shadow-md">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">Add New Task</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <input
                            type="text"
                            name="title"
                            placeholder="Task title"
                            class="p-3 border rounded-md focus:ring-2 focus:ring-indigo-500"
                            required
                        />
                        <input
                            type="date"
                            name="created_date"
                            value="{{ selected_date or (now.strftime('%Y-%m-%d') if now else '') }}"
                            class="p-3 border rounded-md focus:ring-2 focus:ring-indigo-500"
                            required
                        />
                        <input
                            type="text"
                            name="Notes"
                            placeholder="Enter notes"
                            class="p-3 border rounded-md focus:ring-2 focus:ring-indigo-500"
                        />
                        <select
                            name="category"
                            class="p-3 border rounded-md focus:ring-2 focus:ring-indigo-500"
                        >
                            <option value="General">General</option>
                            <option value="Work">Work</option>
                            <option value="Personal">Personal</option>
                            <option value="Urgent">Urgent</option>
                        </select>
                    </div>
                    <button
                        type="submit"
                        class="mt-4 w-full bg-indigo-600 text-white py-3 rounded-md hover:bg-indigo-700 transition-colors"
                    >
                        Add Task
                    </button>
                </form>
            </div>
        </div>
    </div>
</body>
</html>